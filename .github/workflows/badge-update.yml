name: badges

on:
  push:
    paths:
      - "tests/**"
      - ".github/workflows/badge-update.yml"
    branches:
      - main
  workflow_call:

jobs:
  build:
    name: badges
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install .
          pip install pytest
          pip install genbadge[all]
      # - name: Coverage badge
      #   run: |
      #       pip install coverage
      #       coverage run -m pytest
      #       coverage xml
      #       genbadge coverage -i coverage.xml
      #       mv coverage-badge.svg docs/assets
      - name: Tests badge
        run: |
            python -m pytest --junitxml=reports/junit/junit.xml
            genbadge tests
            mv tests-badge.svg ./docs/assets
      - name: Commit data
        run: |
            if git diff docs/assets | grep . > /dev/null ; then
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            git pull
            git add docs/assets/*.svg
            git commit -m "update badges"
            git push
            fi